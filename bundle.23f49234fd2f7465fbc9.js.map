{"version":3,"file":"bundle.23f49234fd2f7465fbc9.js","mappings":"mBAAO,MAAMA,EAASC,IAClB,IAAIC,EAIJ,MAAO,CACHC,QAJY,IAAIC,SAAQ,CAACC,EAASC,KAClCJ,EAAQK,OAAOC,WAAWH,EAASJ,MAInCQ,SAAU,IAAMF,OAAOG,aAAaR,KCPtCS,EAAaC,SAASC,cAAc,gBACnC,IAAIC,GACX,SAAWA,GACPA,EAAc,MAAI,QADtB,CAEGA,IAAWA,EAAS,KAEvB,MAAMC,EAAiB,CACnB,CAACD,EAAOE,OAAQL,GAEPM,EAAaC,IACtB,MAAMC,EAAeJ,EAAeG,GACpC,GAAIC,EACA,IACIA,EAAaC,OAEjB,MAAOC,GACHC,QAAQD,MAAM,sBAAuBH,EAAUG,QAInDC,QAAQD,MAAM,sBAAuBH,EAAU,IAAIK,MAAM,iCCjB1D,MAAMC,EACTC,cACIC,KAAKC,SAAW,IAAIC,IAExBC,iBAAiBC,EAAWC,GACnBL,KAAKC,SAASK,IAAIF,GAInBJ,KAAKC,SAASM,IAAIH,GAAWI,KAAKH,GAHlCL,KAAKC,SAASQ,IAAIL,EAAW,CAACC,IAMtCK,oBAAoBN,EAAWC,GAC3B,GAAIL,KAAKC,SAASK,IAAIF,GAAY,CAC9B,MAAMO,EAAYX,KAAKC,SAASM,IAAIH,GAC9BQ,EAAQD,EAAUE,WAAUC,GAAMA,IAAOT,KAChC,IAAXO,GACAD,EAAUI,OAAOH,EAAO,IAIpCI,GAAGZ,EAAWC,GACVL,KAAKG,iBAAiBC,EAAWC,GAErCY,KAAKb,EAAWC,GACZL,KAAKG,iBAAiBC,GAAW,IAAIc,KACjClB,KAAKU,oBAAoBN,EAAWC,GACpCA,KAAYa,MAGpBC,KAAKf,KAAcc,GACXlB,KAAKC,SAASK,IAAIF,IACAJ,KAAKC,SAASM,IAAIH,GAC1BgB,SAAQN,IACd,IACIA,KAAMI,GAEV,MAAOvB,GACHC,QAAQD,MAAM,wBAAwBS,aAAsBT,GAC5DK,KAAKmB,KAzCd,QAyCiCxB,QCvCrC,IAAI0B,GACX,SAAWA,GACPA,EAAYA,EAAqB,QAAI,GAAK,UAC1CA,EAAYA,EAAoB,OAAI,GAAK,SACzCA,EAAYA,EAAkB,KAAI,GAAK,OAH3C,CAIGA,IAAgBA,EAAc,KAE1B,MAAMC,EACTvB,YAAYwB,GACRvB,KAAKwB,MAAQH,EAAYI,OACzBzB,KAAK0B,gBAAkB,IAAIxB,IAC3BF,KAAK2B,eAAiB,EACtB3B,KAAK4B,MAAQ,IAAI9B,EACjB,MAAM,QAAE+B,EAAO,MAAEC,EAAK,SAAEC,EAAQ,OAAEC,GAAYT,EAC9CvB,KAAK6B,QAAUA,EACf7B,KAAK+B,SAAWA,EAChB/B,KAAKgC,OAASA,EACdhC,KAAK6B,QAAQT,SAAQa,IACjB,MAAMC,EAAOC,OAAOD,KAAKJ,GACnBM,EAAa,GACnB,IAAK,MAAMC,KAAOH,EAAM,CACpB,MAAMI,EAAQL,EAAOI,GACP,OAAVC,QAA4BC,IAAVD,IAClBF,EAAWC,GAAO,CACdG,KAAMF,EACNG,GAAIX,EAAMO,KAItBrC,KAAK0B,gBAAgBjB,IAAIwB,EAAQG,MAGzCM,OAAOC,GACH,GAAI3C,KAAKwB,QAAUH,EAAYuB,QAC3B,OAIJ,IAAIC,GAFQC,KAAKC,MACc/C,KAAKgD,UAAYhD,KAAK2B,gBACb3B,KAAK+B,SACzCc,EAAiB,IACjBA,EAAiB,GAErB,IAAII,EAAWJ,EACX7C,KAAKgC,SACLiB,EAAWjD,KAAKgC,OAAOa,IAE3B7C,KAAK0B,gBAAgBN,SAAQ,CAACgB,EAAYH,KACtC,IAAK,MAAOI,GAAK,KAAEG,EAAI,GAAEC,MAASN,OAAOe,QAAQd,GAAa,CAC1D,MAAMe,EAAIX,GAAQC,EAAKD,GAAQS,EAC/BhB,EAAOI,GAAOc,MAGlBN,GAAkB,IAClB7C,KAAKwB,MAAQH,EAAY+B,KACzBpD,KAAK4B,MAAMT,KAAKG,EAAM+B,OAAOC,WAGrCC,QACQvD,KAAKwB,OAASxB,KAAKwB,QAAUH,EAAYI,SAG7CzB,KAAKwB,MAAQH,EAAYuB,QACpB5C,KAAKgD,YACNhD,KAAKgD,UAAYF,KAAKC,OAEtB/C,KAAKwD,aACLxD,KAAK2B,gBAAkBmB,KAAKC,MAAQ/C,KAAKwD,WACzCxD,KAAKwD,WAAa,GAEtBxD,KAAK4B,MAAMT,KAAKG,EAAM+B,OAAOI,QAEjCC,QACQ1D,KAAKwB,QAAUH,EAAYuB,UAG/B5C,KAAKwB,MAAQH,EAAYI,OACzBzB,KAAKwD,WAAaV,KAAKC,MACvB/C,KAAK4B,MAAMT,KAAKG,EAAM+B,OAAO5B,SAEjCkC,OACQ3D,KAAKwB,QAAUH,EAAY+B,OAG/BpD,KAAKwB,MAAQH,EAAY+B,KACzBpD,KAAK4B,MAAMT,KAAKG,EAAM+B,OAAOD,OAEjCQ,QAAQC,GACJ7D,KAAK4B,MAAMzB,iBAAiBmB,EAAM+B,OAAOI,MAAOI,GAEpDC,SAASD,GACL7D,KAAK4B,MAAMzB,iBAAiBmB,EAAM+B,OAAO5B,OAAQoC,GAErDE,WAAWF,GACP7D,KAAK4B,MAAMzB,iBAAiBmB,EAAM+B,OAAOC,SAAUO,GAEvDG,OAAOH,GACH7D,KAAK4B,MAAMzB,iBAAiBmB,EAAM+B,OAAOD,KAAMS,IAGvDvC,EAAM+B,OAAS,CACXI,MAAO,QACPhC,OAAQ,SACR6B,SAAU,WACVF,KAAM,QC1GH,MAKMa,EAAY,CACrBC,GAAKC,GACMA,EAASA,EAEpBC,IAAMD,GACKA,GAAU,EAAIA,GAEzBE,MAAQF,IACCA,GAAU,GAAK,EACT,GAAMA,EAASA,GAElB,MAASA,GAAUA,EAAS,GAAK,IAGpCG,EAAQ,CACjBJ,GAAKC,GACMA,EAASA,EAASA,EAE7BC,IAAMD,KACOA,EAASA,EAASA,EAAS,EAExCE,MAAQF,IACCA,GAAU,GAAK,EACT,GAAMA,EAASA,EAASA,EAE5B,KAAQA,GAAU,GAAKA,EAASA,EAAS,IC7BjD,MAAMI,EACTxE,cACIC,KAAKwE,OAAS,IAAIC,IAClBzE,KAAK0E,SAAY/B,IACb,IACI3C,KAAK0C,OAAOC,GAEhB,MAAOhD,GACHC,QAAQD,MAAM,gCAAkCA,GAEpDd,OAAO8F,sBAAsB3E,KAAK0E,WAEtC1E,KAAK0E,WAEThC,OAAOC,GACH3C,KAAKwE,OAAOpD,SAAQwD,GAASA,EAAMlC,OAAOC,KAE9CkC,IAAItD,GACA,MAAMqD,EAAQ,IAAItD,EAAMC,GAClBxC,EAAW,IAAMiB,KAAK8E,OAAOF,GAKnC,OAJAA,EAAMb,WAAWhF,GACjB6F,EAAMZ,OAAOjF,GACbiB,KAAKwE,OAAOK,IAAID,GAChBA,EAAMrB,QACCqB,EAEXE,OAAOF,GACC5E,KAAKwE,OAAOlE,IAAIsE,IAChBA,EAAMjB,OACN3D,KAAKwE,OAAOO,OAAOH,IAGnBhF,QAAQoF,KAAK,wCAGrBtB,MAAMkB,GACE5E,KAAKwE,OAAOlE,IAAIsE,GAChBA,EAAMlB,QAGN9D,QAAQoF,KAAK,uCAGrBrB,KAAKiB,GACD5E,KAAK8E,OAAOF,IC7Cb,MAAMK,EAAmB,ICI1BC,EAAkB,CACpBC,QAAS,GACTpD,SAAU,KAERqD,EAAgBlG,SAASC,cAAc,mBACvCkG,EAAenG,SAASC,cAAc,mBAEtCmG,GADoBpG,SAASC,cAAc,uBACvBD,SAASC,cAAc,wBAC3CoG,EAAe,IAAIhB,EACzB,IAEIiB,EAFAC,GAAoB,EACpBC,EAAgB,EAEpB,MAAMC,EAAa,IAAIC,MAAM,CACzBC,GAAIT,EAAcU,aAAa,MAChC,CACCvF,IAAK,CAAC0B,EAAQI,EAAK0D,KACf,OAAQ1D,GACJ,IAAK,IACD,OAAQ+C,EAAcU,aAAa,KACvC,QACI,OAAOE,QAAQzF,IAAI0B,EAAQI,EAAK0D,KAG5CtF,IAAK,CAACwB,EAAQI,EAAKC,EAAOyD,KACtB,OAAQ1D,GACJ,IAAK,IAGD,OAFA+C,EAAca,aAAa,IAAK3D,GAChC+C,EAAaa,MAAMC,UAAY,cAAc7D,EAAQ,UAC9C,EACX,QACI,OAAO0D,QAAQvF,IAAIwB,EAAQI,EAAKC,EAAOyD,OAIjDK,EAAsB,KACnBd,IAGDG,GAGAC,GAAiB,MAGnBA,EACFD,GAAoB,EACpBH,EAAkBe,kBAElBf,IACA1F,QAAQ0G,IAAI,sCACZhB,EAAkBnF,iBAAiB,YAAY,KAC3CP,QAAQ0G,IAAI,qBACZb,GAAoB,EAChBC,EAAgB,GAChBU,QAIZ,MA2BaG,EAAiBhF,IAC1B,IAAI,QAAE4D,EAAUD,EAAgBC,QAAO,SAAEpD,EAAWmD,EAAgBnD,UAAcR,EAC9E4D,GAAW,IACXA,EAAUD,EAAgBC,SAE1BpD,GAAY,IACZA,EAAWmD,EAAgBnD,UAE/B,IAAIyE,EAbW,CAACrB,IAChB,IAAIqB,EAAUb,EAAWE,EAEzB,OADAW,EAAWA,EAAUrB,EAAWF,EAAmBuB,EAAUrB,EAAUF,EAChEuB,GAUOC,CAAWtB,GACzB,GAAIqB,GAAW,EACX,OAAO9H,QAAQC,UAEd,CACD6G,MAAAA,GAAkFA,IAC9EE,EAAgB,EAChBA,EAAgB,EAGhBpH,EAAMkI,EAAU,EAAI,IAAM,GAAG/H,QAAQiI,MAAK,KACtChB,EAAgB,EAChBU,OAGR,MAAM,QAAE3H,EAAO,SAAEM,GAlDC,EAACyH,EAASzE,KAChC,IAAIhD,EAmBJ,MAAO,CAAEN,QAlBO,IAAIC,SAAQ,CAACC,EAASC,KAClC,MAAMgG,EAAQW,EAAaV,IAAI,CAC3BhD,QAAS,CAAC8D,GACV7D,MAAO,CAAE+D,EAAGW,GACZzE,SAAUA,EACVC,OAAQ,UAEZ4C,EAAMb,YAAW,KACbnE,QAAQ0G,IAAI,aACZd,EAA0B,OAC1B7G,OAEJI,EAAW,KACP6F,EAAMjB,OACN6B,EAA0B,OAC1B5G,EAAO,oBAGGG,SAAAA,IA8BgB4H,CAAkBH,EAASzE,GAEzD,OADAyD,EAA0BzG,EACnBN,IChHTmI,EAAwB1H,SAASC,cAAc,6BAC/C,EAAgBD,SAASC,cAAc,mBACvC,EAAe,IAAIoF,EACzB,IAAIsC,GAAsB,EAC1B,MAAMC,EAAa,IAAIlB,MAAM,CACzBC,GAAIe,EAAsBd,aAAa,MACxC,CACCvF,IAAK,CAAC0B,EAAQI,EAAK0D,KACf,OAAQ1D,GACJ,IAAK,IACD,OAAQuE,EAAsBd,aAAa,KAC/C,QACI,OAAOE,QAAQzF,IAAI0B,EAAQI,EAAK0D,KAG5CtF,IAAK,CAACwB,EAAQI,EAAKC,EAAOyD,KACtB,OAAQ1D,GACJ,IAAK,IAED,OADAuE,EAAsBX,aAAa,IAAK3D,IACjC,EACX,QACI,OAAO0D,QAAQvF,IAAIwB,EAAQI,EAAKC,EAAOyD,OAI1CgB,EAAe,KACxB,GAAIF,EACA,OAGJ,IADkBD,EAAsBd,aAAa,MACrCb,EACZ,OAEJ4B,GAAsB,EACtB,MAAMjC,EAAQ,EAAaC,IAAI,CAC3BhD,QAAS,CAACiF,GACVhF,MAAO,CAAE+D,EAAG,KACZ9D,SAAU,IACVC,OAAQ,OAENgF,EAAgB,KAClBH,GAAsB,GACJ,EAAcf,aAAa,MAC7Bb,GACZgC,EAAa,IAGrBrC,EAAMb,WAAWiD,GACjBpC,EAAMZ,OAAOgD,IAEJC,EAAe,CAAClF,EAAW,OAEpC,IADkB6E,EAAsBd,aAAa,MACrCb,EACZ,OAEJ,MAAMuB,GAAW,EAAcV,aAAa,KAC5B,OAAZU,QAAgCjE,IAAZiE,GACpB,EAAa3B,IAAI,CACbhD,QAAS,CAACiF,GACVhF,MAAO,CAAE+D,EAAGW,GACZzE,SAAAA,EACAC,OAAQ,SC3DdkF,EAAYhI,SAASC,cAAc,cACzC,IAAIgI,GAAc,EACdC,GAAyB,EAC7B,MA8DM1C,EAAY2C,IAtDE,CAAC1E,IACjB,GAAIwE,IAAgBC,EAAwB,CACxCA,GAAyB,EACzB,MAAME,EAAkB,KACpB,EAAuB,SACvB,IACA,EAA+B,IAC1BZ,MAAK,KACFS,EACAG,KAGAF,GAAyB,EACzB,QAGHG,OAAO5H,IAAYC,QAAQoF,KAAKrF,OAEzC2H,MAsCJE,GACA3I,OAAO8F,sBAAsBD,IAEjC7F,OAAO4I,OAAS,KARZ7H,QAAQ0G,IAAI,eA9BS,MACrB,IAAIoB,EACAC,EACJ,MAAMC,EAAmB,KACrBF,EAAiB7I,OAAOgJ,YAAY9E,MACpCnD,QAAQ0G,IAAI,uBAAwBoB,GACpC,MAAQjJ,QAASqJ,EAAc/I,SAAUgJ,GAAmBzJ,EAAM,KAClEqJ,EAAyBI,EACzBD,EAAapB,MAAK,KACd9G,QAAQ0G,IAAI,qBACZa,GAAc,MAGhBa,EAAiB,KACnBpI,QAAQ0G,IAAI,qBAAsBzH,OAAOgJ,YAAY9E,OACrD4E,IACKR,GAIDvH,QAAQ0G,IAAI,mBACZa,GAAc,IAjDtBvH,QAAQ0G,IAAI,qBACZ,EAAuB,SACvB,IACA,EAA+B,IAC1BI,MAAK,IAAM,MACXa,OAAO5H,IAAYC,QAAQoF,KAAKrF,QA+CrCuH,EAAU/G,iBAAiB,aAAcyH,GACzCV,EAAU/G,iBAAiB,WAAY6H,GACvCd,EAAU/G,iBAAiB,YAAayH,GACxCV,EAAU/G,iBAAiB,UAAW6H,IAItCC,GASAvD,EAAS7F,OAAOgJ,YAAY9E,S","sources":["webpack://drink-milk-tea/./src/utils.ts","webpack://drink-milk-tea/./src/AudioManager.ts","webpack://drink-milk-tea/./src/libs/event-emitter/event.ts","webpack://drink-milk-tea/./src/libs/tween/tween.ts","webpack://drink-milk-tea/./src/libs/tween/easing.ts","webpack://drink-milk-tea/./src/libs/tween/tweenManger.ts","webpack://drink-milk-tea/./src/constants/index.ts","webpack://drink-milk-tea/./src/waterAnimManager.ts","webpack://drink-milk-tea/./src/strawAnimManager.ts","webpack://drink-milk-tea/./src/index.ts"],"sourcesContent":["export const delay = (time) => {\r\n    let timer;\r\n    const promise = new Promise((resolve, reject) => {\r\n        timer = window.setTimeout(resolve, time);\r\n    });\r\n    return {\r\n        promise,\r\n        disposer: () => window.clearTimeout(timer),\r\n    };\r\n};\r\n","const drinkAudio = document.querySelector('#drink-audio');\r\nexport var AUDIOS;\r\n(function (AUDIOS) {\r\n    AUDIOS[\"DRINK\"] = \"drink\";\r\n})(AUDIOS || (AUDIOS = {}));\r\n;\r\nconst AUDIO_ELEMENTS = {\r\n    [AUDIOS.DRINK]: drinkAudio,\r\n};\r\nexport const playAudio = (audioKey) => {\r\n    const audioElement = AUDIO_ELEMENTS[audioKey];\r\n    if (audioElement) {\r\n        try {\r\n            audioElement.play();\r\n        }\r\n        catch (error) {\r\n            console.error('fail to play audio ', audioKey, error);\r\n        }\r\n    }\r\n    else {\r\n        console.error('fail to play audio ', audioKey, new Error('can not find audio element.'));\r\n    }\r\n};\r\n// TODO: stop audio\r\n","export const EVENTS = {\r\n    ERROR: 'error',\r\n};\r\nexport class EventEmitter {\r\n    constructor() {\r\n        this.eventMap = new Map();\r\n    }\r\n    addEventListener(eventName, listener) {\r\n        if (!this.eventMap.has(eventName)) {\r\n            this.eventMap.set(eventName, [listener]);\r\n        }\r\n        else {\r\n            this.eventMap.get(eventName).push(listener);\r\n        }\r\n    }\r\n    removeEventListener(eventName, listener) {\r\n        if (this.eventMap.has(eventName)) {\r\n            const listeners = this.eventMap.get(eventName);\r\n            const index = listeners.findIndex(el => el === listener);\r\n            if (index !== -1) {\r\n                listeners.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n    on(eventName, listener) {\r\n        this.addEventListener(eventName, listener);\r\n    }\r\n    once(eventName, listener) {\r\n        this.addEventListener(eventName, (...args) => {\r\n            this.removeEventListener(eventName, listener);\r\n            listener(...args);\r\n        });\r\n    }\r\n    emit(eventName, ...args) {\r\n        if (this.eventMap.has(eventName)) {\r\n            const listeners = this.eventMap.get(eventName);\r\n            listeners.forEach(el => {\r\n                try {\r\n                    el(...args);\r\n                }\r\n                catch (error) {\r\n                    console.error(`fail to excute event ${eventName}, error: `, error);\r\n                    this.emit(EVENTS.ERROR, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n","// @ts-check\r\nimport { EventEmitter } from '../event-emitter';\r\n;\r\nexport var TWEEN_STATE;\r\n(function (TWEEN_STATE) {\r\n    TWEEN_STATE[TWEEN_STATE[\"RUNNING\"] = 1] = \"RUNNING\";\r\n    TWEEN_STATE[TWEEN_STATE[\"PAUSED\"] = 2] = \"PAUSED\";\r\n    TWEEN_STATE[TWEEN_STATE[\"STOP\"] = 3] = \"STOP\";\r\n})(TWEEN_STATE || (TWEEN_STATE = {}));\r\n;\r\nexport class Tween {\r\n    constructor(options) {\r\n        this.state = TWEEN_STATE.PAUSED;\r\n        this.targetStatesMap = new Map();\r\n        this.pausedDuration = 0;\r\n        this.event = new EventEmitter();\r\n        const { targets, attrs, duration, easing, } = options;\r\n        this.targets = targets;\r\n        this.duration = duration;\r\n        this.easing = easing;\r\n        this.targets.forEach(target => {\r\n            const keys = Object.keys(attrs);\r\n            const attrStates = {};\r\n            for (const key of keys) {\r\n                const value = target[key];\r\n                if (value !== null || value !== undefined) {\r\n                    attrStates[key] = {\r\n                        from: value,\r\n                        to: attrs[key],\r\n                    };\r\n                }\r\n            }\r\n            this.targetStatesMap.set(target, attrStates);\r\n        });\r\n    }\r\n    update(elapsedTime) {\r\n        if (this.state !== TWEEN_STATE.RUNNING) {\r\n            return;\r\n        }\r\n        const now = Date.now();\r\n        const totalElapsedTime = now - this.startTime - this.pausedDuration;\r\n        let originProgress = totalElapsedTime / this.duration;\r\n        if (originProgress > 1) {\r\n            originProgress = 1;\r\n        }\r\n        let progress = originProgress;\r\n        if (this.easing) {\r\n            progress = this.easing(originProgress);\r\n        }\r\n        this.targetStatesMap.forEach((attrStates, target) => {\r\n            for (const [key, { from, to }] of Object.entries(attrStates)) {\r\n                const v = from + (to - from) * progress;\r\n                target[key] = v;\r\n            }\r\n        });\r\n        if (originProgress >= 1) {\r\n            this.state = TWEEN_STATE.STOP;\r\n            this.event.emit(Tween.EVENTS.COMPLETE);\r\n        }\r\n    }\r\n    start() {\r\n        if (this.state && this.state !== TWEEN_STATE.PAUSED) {\r\n            return;\r\n        }\r\n        this.state = TWEEN_STATE.RUNNING;\r\n        if (!this.startTime) {\r\n            this.startTime = Date.now();\r\n        }\r\n        if (this.pausedTime) {\r\n            this.pausedDuration += Date.now() - this.pausedTime;\r\n            this.pausedTime = 0;\r\n        }\r\n        this.event.emit(Tween.EVENTS.START);\r\n    }\r\n    pause() {\r\n        if (this.state !== TWEEN_STATE.RUNNING) {\r\n            return;\r\n        }\r\n        this.state = TWEEN_STATE.PAUSED;\r\n        this.pausedTime = Date.now();\r\n        this.event.emit(Tween.EVENTS.PAUSED);\r\n    }\r\n    stop() {\r\n        if (this.state === TWEEN_STATE.STOP) {\r\n            return;\r\n        }\r\n        this.state = TWEEN_STATE.STOP;\r\n        this.event.emit(Tween.EVENTS.STOP);\r\n    }\r\n    onStart(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.START, cb);\r\n    }\r\n    onPaused(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.PAUSED, cb);\r\n    }\r\n    onComplete(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.COMPLETE, cb);\r\n    }\r\n    onStop(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.STOP, cb);\r\n    }\r\n}\r\nTween.EVENTS = {\r\n    START: 'start',\r\n    PAUSED: 'paused',\r\n    COMPLETE: 'complete',\r\n    STOP: 'stop',\r\n};\r\n","export const Linear = {\r\n    None: (amount) => {\r\n        return amount;\r\n    },\r\n};\r\nexport const Quadratic = {\r\n    In: (amount) => {\r\n        return amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return amount * (2 - amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount;\r\n        }\r\n        return -0.5 * (--amount * (amount - 2) - 1);\r\n    },\r\n};\r\nexport const Cubic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return --amount * amount * amount + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount;\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n    },\r\n};\r\nexport const Quartic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return 1 - --amount * amount * amount * amount;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount * amount;\r\n        }\r\n        return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n    },\r\n};\r\nexport const Quintic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return --amount * amount * amount * amount * amount + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount * amount * amount;\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n    },\r\n};\r\nexport const Sinusoidal = {\r\n    In: (amount) => {\r\n        return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\r\n    },\r\n    Out: (amount) => {\r\n        return Math.sin((amount * Math.PI) / 2);\r\n    },\r\n    InOut: (amount) => {\r\n        return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\r\n    },\r\n};\r\nexport const Exponential = {\r\n    In: (amount) => {\r\n        return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n    },\r\n    Out: (amount) => {\r\n        return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * Math.pow(1024, amount - 1);\r\n        }\r\n        return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n    },\r\n};\r\nexport const Circular = {\r\n    In: (amount) => {\r\n        return 1 - Math.sqrt(1 - amount * amount);\r\n    },\r\n    Out: (amount) => {\r\n        return Math.sqrt(1 - --amount * amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n        }\r\n        return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n    },\r\n};\r\nexport const Elastic = {\r\n    In: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n    },\r\n    Out: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        amount *= 2;\r\n        if (amount < 1) {\r\n            return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        }\r\n        return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n    },\r\n};\r\nexport const Back = {\r\n    In: (amount) => {\r\n        const s = 1.70158;\r\n        return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\r\n    },\r\n    Out: (amount) => {\r\n        const s = 1.70158;\r\n        return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        const s = 1.70158 * 1.525;\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n    },\r\n};\r\nexport const Bounce = {\r\n    In: (amount) => {\r\n        return 1 - Bounce.Out(1 - amount);\r\n    },\r\n    Out: (amount) => {\r\n        if (amount < 1 / 2.75) {\r\n            return 7.5625 * amount * amount;\r\n        }\r\n        else if (amount < 2 / 2.75) {\r\n            return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n        }\r\n        else if (amount < 2.5 / 2.75) {\r\n            return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n        }\r\n        else {\r\n            return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n        }\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount < 0.5) {\r\n            return Bounce.In(amount * 2) * 0.5;\r\n        }\r\n        return Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n    },\r\n};\r\nexport const generatePow = (power = 4) => {\r\n    power = power < Number.EPSILON ? Number.EPSILON : power;\r\n    power = power > 10000 ? 10000 : power;\r\n    return {\r\n        In: (amount) => {\r\n            return Math.pow(amount, power);\r\n        },\r\n        Out: (amount) => {\r\n            return 1 - Math.pow((1 - amount), power);\r\n        },\r\n        InOut: (amount) => {\r\n            if (amount < 0.5) {\r\n                return Math.pow((amount * 2), power) / 2;\r\n            }\r\n            return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\r\n        },\r\n    };\r\n};\r\n","import { Tween } from './tween';\r\nexport class TweenManager {\r\n    constructor() {\r\n        this.tweens = new Set();\r\n        this.mainLoop = (elapsedTime) => {\r\n            try {\r\n                this.update(elapsedTime);\r\n            }\r\n            catch (error) {\r\n                console.error('fail to update tween, error: ' + error);\r\n            }\r\n            window.requestAnimationFrame(this.mainLoop);\r\n        };\r\n        this.mainLoop();\r\n    }\r\n    update(elapsedTime) {\r\n        this.tweens.forEach(tween => tween.update(elapsedTime));\r\n    }\r\n    add(options) {\r\n        const tween = new Tween(options);\r\n        const disposer = () => this.remove(tween);\r\n        tween.onComplete(disposer);\r\n        tween.onStop(disposer);\r\n        this.tweens.add(tween);\r\n        tween.start();\r\n        return tween;\r\n    }\r\n    remove(tween) {\r\n        if (this.tweens.has(tween)) {\r\n            tween.stop();\r\n            this.tweens.delete(tween);\r\n        }\r\n        else {\r\n            console.warn('fail to remove tween, can not found.');\r\n        }\r\n    }\r\n    pause(tween) {\r\n        if (this.tweens.has(tween)) {\r\n            tween.pause();\r\n        }\r\n        else {\r\n            console.warn('fail to pause tween, can not found.');\r\n        }\r\n    }\r\n    stop(tween) {\r\n        this.remove(tween);\r\n    }\r\n}\r\n","export const MAX_WATER_MASK_Y = 587;\r\n","import { TweenManager, Easing } from './libs/tween';\r\nimport { delay } from './utils';\r\nimport { MAX_WATER_MASK_Y } from './constants';\r\n;\r\nconst DEFAULT_OPTIONS = {\r\n    offsetY: 20,\r\n    duration: 1000,\r\n};\r\nconst maskStrawRect = document.querySelector('#maskstraw-rect');\r\nconst cupBodyWtaer = document.querySelector('#cup-body-wtaer');\r\nconst maskWaterWavePath = document.querySelector('#maskwaterwave-path');\r\nconst maskWaterWaveAnim = document.querySelector('#maskwaterwave-anim');\r\nconst tweenManager = new TweenManager();\r\nlet isPlayingWaveAnim = false;\r\nlet waveAnimQueue = 0;\r\nlet runningWaveAnimDisposer;\r\nconst waterProxy = new Proxy({\r\n    y: +maskStrawRect.getAttribute('y'),\r\n}, {\r\n    get: (target, key, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                return +maskStrawRect.getAttribute('y');\r\n            default:\r\n                return Reflect.get(target, key, receiver);\r\n        }\r\n    },\r\n    set: (target, key, value, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                maskStrawRect.setAttribute('y', value);\r\n                cupBodyWtaer.style.transform = `translateY(${value - 300}px)`;\r\n                return true;\r\n            default:\r\n                return Reflect.set(target, key, value, receiver);\r\n        }\r\n    }\r\n});\r\nconst playWaterWobbleAnim = () => {\r\n    if (!maskWaterWaveAnim) {\r\n        return;\r\n    }\r\n    if (isPlayingWaveAnim) {\r\n        return;\r\n    }\r\n    if (waveAnimQueue <= 0) {\r\n        return;\r\n    }\r\n    --waveAnimQueue;\r\n    isPlayingWaveAnim = true;\r\n    maskWaterWaveAnim.beginElement();\r\n};\r\nif (maskWaterWaveAnim) {\r\n    console.log('register maskWaterWaveAnim events.');\r\n    maskWaterWaveAnim.addEventListener('endEvent', () => {\r\n        console.log('endEvent trigger.');\r\n        isPlayingWaveAnim = false;\r\n        if (waveAnimQueue > 0) {\r\n            playWaterWobbleAnim();\r\n        }\r\n    });\r\n}\r\nconst playWaterDownAnim = (targetY, duration) => {\r\n    let disposer;\r\n    const promise = new Promise((resolve, reject) => {\r\n        const tween = tweenManager.add({\r\n            targets: [waterProxy],\r\n            attrs: { y: targetY, },\r\n            duration: duration,\r\n            easing: Easing.Cubic.InOut,\r\n        });\r\n        tween.onComplete(() => {\r\n            console.log('complete.');\r\n            runningWaveAnimDisposer = () => { };\r\n            resolve();\r\n        });\r\n        disposer = () => {\r\n            tween.stop();\r\n            runningWaveAnimDisposer = () => { };\r\n            reject('anim cancel.');\r\n        };\r\n    });\r\n    return { promise, disposer };\r\n};\r\nconst calTargetY = (offsetY) => {\r\n    let targetY = waterProxy.y;\r\n    targetY = (targetY + offsetY) < MAX_WATER_MASK_Y ? targetY + offsetY : MAX_WATER_MASK_Y;\r\n    return targetY;\r\n};\r\nexport const playDrinkAnim = (options) => {\r\n    let { offsetY = DEFAULT_OPTIONS.offsetY, duration = DEFAULT_OPTIONS.duration, } = options;\r\n    if (offsetY <= 0) {\r\n        offsetY = DEFAULT_OPTIONS.offsetY;\r\n    }\r\n    if (duration <= 0) {\r\n        duration = DEFAULT_OPTIONS.duration;\r\n    }\r\n    let targetY = calTargetY(offsetY);\r\n    if (targetY <= 0) {\r\n        return Promise.resolve();\r\n    }\r\n    else {\r\n        runningWaveAnimDisposer === null || runningWaveAnimDisposer === void 0 ? void 0 : runningWaveAnimDisposer();\r\n        if (waveAnimQueue > 0) {\r\n            waveAnimQueue = 3;\r\n        }\r\n        else {\r\n            delay(targetY > 0 ? 200 : 0).promise.then(() => {\r\n                waveAnimQueue = 3;\r\n                playWaterWobbleAnim();\r\n            });\r\n        }\r\n        const { promise, disposer } = playWaterDownAnim(targetY, duration);\r\n        runningWaveAnimDisposer = disposer;\r\n        return promise;\r\n    }\r\n};\r\n","import { TweenManager, Easing } from './libs/tween';\r\nimport { MAX_WATER_MASK_Y } from './constants';\r\nconst maskStrawDrinkingRect = document.querySelector('#mask-straw-drinking-rect');\r\nconst maskStrawRect = document.querySelector('#maskstraw-rect');\r\nconst tweenManager = new TweenManager();\r\nlet isPlayingRisingAnim = false;\r\nconst strawProxy = new Proxy({\r\n    y: +maskStrawDrinkingRect.getAttribute('y'),\r\n}, {\r\n    get: (target, key, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                return +maskStrawDrinkingRect.getAttribute('y');\r\n            default:\r\n                return Reflect.get(target, key, receiver);\r\n        }\r\n    },\r\n    set: (target, key, value, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                maskStrawDrinkingRect.setAttribute('y', value);\r\n                return true;\r\n            default:\r\n                return Reflect.set(target, key, value, receiver);\r\n        }\r\n    }\r\n});\r\nexport const playRiseAnim = () => {\r\n    if (isPlayingRisingAnim) {\r\n        return;\r\n    }\r\n    const curMaskY = +maskStrawDrinkingRect.getAttribute('y');\r\n    if (curMaskY >= MAX_WATER_MASK_Y) {\r\n        return;\r\n    }\r\n    isPlayingRisingAnim = true;\r\n    const tween = tweenManager.add({\r\n        targets: [strawProxy],\r\n        attrs: { y: 100 },\r\n        duration: 200,\r\n        easing: Easing.Quadratic.In,\r\n    });\r\n    const handleAnimEnd = () => {\r\n        isPlayingRisingAnim = false;\r\n        const curMaskY = +maskStrawRect.getAttribute('y');\r\n        if (curMaskY >= MAX_WATER_MASK_Y) {\r\n            playDropAnim(1);\r\n        }\r\n    };\r\n    tween.onComplete(handleAnimEnd);\r\n    tween.onStop(handleAnimEnd);\r\n};\r\nexport const playDropAnim = (duration = 160) => {\r\n    const curMaskY = +maskStrawDrinkingRect.getAttribute('y');\r\n    if (curMaskY >= MAX_WATER_MASK_Y) {\r\n        return;\r\n    }\r\n    const targetY = +maskStrawRect.getAttribute('y');\r\n    if (targetY !== null || targetY !== undefined) {\r\n        tweenManager.add({\r\n            targets: [strawProxy],\r\n            attrs: { y: targetY, },\r\n            duration,\r\n            easing: Easing.Quadratic.Out,\r\n        });\r\n    }\r\n};\r\n","import { delay } from './utils';\r\nimport * as AudioManager from './AudioManager';\r\nimport * as WaterAnimManager from './waterAnimManager';\r\nimport * as StrawAnimManager from './strawAnimManager';\r\nconst container = document.querySelector('#container');\r\nlet isLongPress = false;\r\nlet isPlayingLongPressAnim = false;\r\nconst handleClickCup = () => {\r\n    console.log('container clicked');\r\n    AudioManager.playAudio(AudioManager.AUDIOS.DRINK);\r\n    StrawAnimManager.playRiseAnim();\r\n    WaterAnimManager.playDrinkAnim({})\r\n        .then(() => StrawAnimManager.playDropAnim())\r\n        .catch((error) => { console.warn(error); });\r\n};\r\nconst updateWater = (elapsedTime) => {\r\n    if (isLongPress && !isPlayingLongPressAnim) {\r\n        isPlayingLongPressAnim = true;\r\n        const doPlayDrinkAnim = () => {\r\n            AudioManager.playAudio(AudioManager.AUDIOS.DRINK);\r\n            StrawAnimManager.playRiseAnim();\r\n            WaterAnimManager.playDrinkAnim({})\r\n                .then(() => {\r\n                if (isLongPress) {\r\n                    doPlayDrinkAnim();\r\n                }\r\n                else {\r\n                    isPlayingLongPressAnim = false;\r\n                    StrawAnimManager.playDropAnim();\r\n                }\r\n            })\r\n                .catch((error) => { console.warn(error); });\r\n        };\r\n        doPlayDrinkAnim();\r\n    }\r\n};\r\nconst setupTouchEvents = () => {\r\n    let touchStartTime;\r\n    let longPressTimerDisposer;\r\n    const handleTouchStart = () => {\r\n        touchStartTime = window.performance.now();\r\n        console.log('container touchstart', touchStartTime);\r\n        const { promise: delayPromise, disposer: delayDisposer, } = delay(350);\r\n        longPressTimerDisposer = delayDisposer;\r\n        delayPromise.then(() => {\r\n            console.log('start long press.');\r\n            isLongPress = true;\r\n        });\r\n    };\r\n    const handleTouchEnd = () => {\r\n        console.log('container touchend', window.performance.now());\r\n        longPressTimerDisposer();\r\n        if (!isLongPress) {\r\n            handleClickCup();\r\n        }\r\n        else {\r\n            console.log('end long press.');\r\n            isLongPress = false;\r\n        }\r\n    };\r\n    container.addEventListener('touchstart', handleTouchStart);\r\n    container.addEventListener('touchend', handleTouchEnd);\r\n    container.addEventListener('mousedown', handleTouchStart);\r\n    container.addEventListener('mouseup', handleTouchEnd);\r\n};\r\nconst setupEvents = () => {\r\n    console.log('setupEvents');\r\n    setupTouchEvents();\r\n};\r\nconst mainLoop = (timestamp) => {\r\n    // console.log('mainLoop', timestamp);\r\n    updateWater();\r\n    window.requestAnimationFrame(mainLoop);\r\n};\r\nwindow.onload = () => {\r\n    setupEvents();\r\n    mainLoop(window.performance.now());\r\n};\r\n"],"names":["delay","time","timer","promise","Promise","resolve","reject","window","setTimeout","disposer","clearTimeout","drinkAudio","document","querySelector","AUDIOS","AUDIO_ELEMENTS","DRINK","playAudio","audioKey","audioElement","play","error","console","Error","EventEmitter","constructor","this","eventMap","Map","addEventListener","eventName","listener","has","get","push","set","removeEventListener","listeners","index","findIndex","el","splice","on","once","args","emit","forEach","TWEEN_STATE","Tween","options","state","PAUSED","targetStatesMap","pausedDuration","event","targets","attrs","duration","easing","target","keys","Object","attrStates","key","value","undefined","from","to","update","elapsedTime","RUNNING","originProgress","Date","now","startTime","progress","entries","v","STOP","EVENTS","COMPLETE","start","pausedTime","START","pause","stop","onStart","cb","onPaused","onComplete","onStop","Quadratic","In","amount","Out","InOut","Cubic","TweenManager","tweens","Set","mainLoop","requestAnimationFrame","tween","add","remove","delete","warn","MAX_WATER_MASK_Y","DEFAULT_OPTIONS","offsetY","maskStrawRect","cupBodyWtaer","maskWaterWaveAnim","tweenManager","runningWaveAnimDisposer","isPlayingWaveAnim","waveAnimQueue","waterProxy","Proxy","y","getAttribute","receiver","Reflect","setAttribute","style","transform","playWaterWobbleAnim","beginElement","log","playDrinkAnim","targetY","calTargetY","then","playWaterDownAnim","maskStrawDrinkingRect","isPlayingRisingAnim","strawProxy","playRiseAnim","handleAnimEnd","playDropAnim","container","isLongPress","isPlayingLongPressAnim","timestamp","doPlayDrinkAnim","catch","updateWater","onload","touchStartTime","longPressTimerDisposer","handleTouchStart","performance","delayPromise","delayDisposer","handleTouchEnd","setupTouchEvents"],"sourceRoot":""}