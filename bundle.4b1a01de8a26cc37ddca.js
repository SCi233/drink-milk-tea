(()=>{"use strict";const t=t=>{let e;return{promise:new Promise(((s,n)=>{e=window.setTimeout(s,t)})),disposer:()=>window.clearTimeout(e)}},e=document.querySelector("#drink-audio");var s;!function(t){t.DRINK="drink"}(s||(s={}));const n={[s.DRINK]:e},o=t=>{const e=n[t];if(e)try{e.play()}catch(e){console.error("fail to play audio ",t,e)}else console.error("fail to play audio ",t,new Error("can not find audio element."))};class r{constructor(){this.eventMap=new Map}addEventListener(t,e){this.eventMap.has(t)?this.eventMap.get(t).push(e):this.eventMap.set(t,[e])}removeEventListener(t,e){if(this.eventMap.has(t)){const s=this.eventMap.get(t),n=s.findIndex((t=>t===e));-1!==n&&s.splice(n,1)}}on(t,e){this.addEventListener(t,e)}once(t,e){this.addEventListener(t,((...s)=>{this.removeEventListener(t,e),e(...s)}))}emit(t,...e){this.eventMap.has(t)&&this.eventMap.get(t).forEach((s=>{try{s(...e)}catch(e){console.error(`fail to excute event ${t}, error: `,e),this.emit("error",e)}}))}}var i;!function(t){t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.STOP=3]="STOP"}(i||(i={}));class a{constructor(t){this.state=i.PAUSED,this.targetStatesMap=new Map,this.pausedDuration=0,this.event=new r;const{targets:e,attrs:s,duration:n,easing:o}=t;this.targets=e,this.duration=n,this.easing=o,this.targets.forEach((t=>{const e=Object.keys(s),n={};for(const o of e){const e=t[o];null===e&&void 0===e||(n[o]={from:e,to:s[o]})}this.targetStatesMap.set(t,n)}))}update(t){if(this.state!==i.RUNNING)return;let e=(Date.now()-this.startTime-this.pausedDuration)/this.duration;e>1&&(e=1);let s=e;this.easing&&(s=this.easing(e)),this.targetStatesMap.forEach(((t,e)=>{for(const[n,{from:o,to:r}]of Object.entries(t)){const t=o+(r-o)*s;e[n]=t}})),e>=1&&(this.state=i.STOP,this.event.emit(a.EVENTS.COMPLETE))}start(){this.state&&this.state!==i.PAUSED||(this.state=i.RUNNING,this.startTime||(this.startTime=Date.now()),this.pausedTime&&(this.pausedDuration+=Date.now()-this.pausedTime,this.pausedTime=0),this.event.emit(a.EVENTS.START))}pause(){this.state===i.RUNNING&&(this.state=i.PAUSED,this.pausedTime=Date.now(),this.event.emit(a.EVENTS.PAUSED))}stop(){this.state!==i.STOP&&(this.state=i.STOP,this.event.emit(a.EVENTS.STOP))}onStart(t){this.event.addEventListener(a.EVENTS.START,t)}onPaused(t){this.event.addEventListener(a.EVENTS.PAUSED,t)}onComplete(t){this.event.addEventListener(a.EVENTS.COMPLETE,t)}onStop(t){this.event.addEventListener(a.EVENTS.STOP,t)}}a.EVENTS={START:"start",PAUSED:"paused",COMPLETE:"complete",STOP:"stop"};const c={In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},u={In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)};class d{constructor(){this.tweens=new Set,this.mainLoop=t=>{try{this.update(t)}catch(t){console.error("fail to update tween, error: "+t)}window.requestAnimationFrame(this.mainLoop)},this.mainLoop()}update(t){this.tweens.forEach((e=>e.update(t)))}add(t){const e=new a(t),s=()=>this.remove(e);return e.onComplete(s),e.onStop(s),this.tweens.add(e),e.start(),e}remove(t){this.tweens.has(t)?(t.stop(),this.tweens.delete(t)):console.warn("fail to remove tween, can not found.")}pause(t){this.tweens.has(t)?t.pause():console.warn("fail to pause tween, can not found.")}stop(t){this.remove(t)}}const h=587,l={offsetY:20,duration:1e3},m=document.querySelector("#maskstraw-rect"),p=document.querySelector("#cup-body-wtaer"),w=(document.querySelector("#maskwaterwave-path"),document.querySelector("#maskwaterwave-anim")),E=new d;let v,f=!1,S=0;const g=new Proxy({y:+m.getAttribute("y")},{get:(t,e,s)=>{switch(e){case"y":return+m.getAttribute("y");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"y":return m.setAttribute("y",s),p.style.transform=`translateY(${s-300}px)`,!0;default:return Reflect.set(t,e,s,n)}}}),y=()=>{w&&(f||S<=0||(--S,f=!0,w.beginElement()))};w&&(console.log("register maskWaterWaveAnim events."),w.addEventListener("endEvent",(()=>{console.log("endEvent trigger."),f=!1,S>0&&y()})));const T=e=>{let{offsetY:s=l.offsetY,duration:n=l.duration}=e;s<=0&&(s=l.offsetY),n<=0&&(n=l.duration);let o=(t=>{let e=g.y;return e=e+t<h?e+t:h,e})(s);if(o<=0)return Promise.resolve();{null==v||v(),S>0?S=3:t(o>0?200:0).promise.then((()=>{S=3,y()}));const{promise:e,disposer:s}=((t,e)=>{let s;return{promise:new Promise(((n,o)=>{const r=E.add({targets:[g],attrs:{y:t},duration:e,easing:u.InOut});r.onComplete((()=>{console.log("complete."),v=()=>{},n()})),s=()=>{r.stop(),v=()=>{},o("anim cancel.")}})),disposer:s}})(o,n);return v=s,e}},N=document.querySelector("#mask-straw-drinking-rect"),P=document.querySelector("#maskstraw-rect"),A=new d;let L=!1;const D=new Proxy({y:+N.getAttribute("y")},{get:(t,e,s)=>{switch(e){case"y":return+N.getAttribute("y");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"y":return N.setAttribute("y",s),!0;default:return Reflect.set(t,e,s,n)}}}),O=document.querySelector("#container");let I=!1,M=!1;const R=()=>{console.log("setupEvents"),(()=>{let e,n;const r=()=>{e=window.performance.now();const{promise:s,disposer:o}=t(350);n=o,s.then((()=>{I=!0}))},i=()=>{n(),I?I=!1:(console.log("container clicked"),o(s.DRINK),(()=>{if(L)return;if(+N.getAttribute("y")>=h)return;L=!0;const t=A.add({targets:[D],attrs:{y:100},duration:200,easing:c.In}),e=()=>L=!1;t.onComplete(e),t.onStop(e)})(),T({}).then((()=>(()=>{if(+N.getAttribute("y")>=h)return;const t=+P.getAttribute("y");null===t&&void 0===t||A.add({targets:[D],attrs:{y:t},duration:160,easing:c.Out})})())).catch((t=>{console.warn(t)})))};O.addEventListener("touchstart",r),O.addEventListener("touchend",i),O.addEventListener("mousedown",r),O.addEventListener("mouseup",i)})()},b=t=>{(t=>{if(I&&!M){M=!0;const t=()=>{T({}).then((()=>{I&&t()})),o(s.DRINK)};t()}})(),window.requestAnimationFrame(b)};window.onload=()=>{R(),b(window.performance.now())}})();
//# sourceMappingURL=bundle.4b1a01de8a26cc37ddca.js.map