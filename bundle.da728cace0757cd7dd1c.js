(()=>{"use strict";class t{constructor(){this.eventMap=new Map}addEventListener(t,e){this.eventMap.has(t)?this.eventMap.get(t).push(e):this.eventMap.set(t,[e])}removeEventListener(t,e){if(this.eventMap.has(t)){const s=this.eventMap.get(t),n=s.findIndex((t=>t===e));-1!==n&&s.splice(n,1)}}on(t,e){this.addEventListener(t,e)}once(t,e){this.addEventListener(t,((...s)=>{this.removeEventListener(t,e),e(...s)}))}emit(t,...e){this.eventMap.has(t)&&this.eventMap.get(t).forEach((s=>{try{s(...e)}catch(e){console.error(`fail to excute event ${t}, error: `,e),this.emit("error",e)}}))}}var e;!function(t){t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.STOP=3]="STOP"}(e||(e={}));class s{constructor(s){this.state=e.PAUSED,this.targetStatesMap=new Map,this.pausedDuration=0,this.event=new t;const{targets:n,attrs:r,duration:a,easing:i}=s;this.targets=n,this.duration=a,this.easing=i,this.targets.forEach((t=>{const e=Object.keys(r),s={};for(const n of e){const e=t[n];null===e&&void 0===e||(s[n]={from:e,to:r[n]})}this.targetStatesMap.set(t,s)}))}update(t){if(this.state!==e.RUNNING)return;let n=(Date.now()-this.startTime-this.pausedDuration)/this.duration;n>1&&(n=1);let r=n;this.easing&&(r=this.easing(n)),this.targetStatesMap.forEach(((t,e)=>{for(const[s,{from:n,to:a}]of Object.entries(t)){const t=n+(a-n)*r;e[s]=t}})),n>=1&&(this.state=e.STOP,this.event.emit(s.EVENTS.COMPLETE))}start(){this.state&&this.state!==e.PAUSED||(this.state=e.RUNNING,this.startTime||(this.startTime=Date.now()),this.pausedTime&&(this.pausedDuration+=Date.now()-this.pausedTime,this.pausedTime=0),this.event.emit(s.EVENTS.START))}pause(){this.state===e.RUNNING&&(this.state=e.PAUSED,this.pausedTime=Date.now(),this.event.emit(s.EVENTS.PAUSED))}onStart(t){this.event.addEventListener(s.EVENTS.START,t)}onPaused(t){this.event.addEventListener(s.EVENTS.PAUSED,t)}onComplete(t){this.event.addEventListener(s.EVENTS.COMPLETE,t)}}s.EVENTS={START:"start",PAUSED:"paused",COMPLETE:"complete"};const n={In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},r=t=>{let e;return{promise:new Promise(((s,n)=>{e=window.setTimeout(s,t)})),disposer:()=>window.clearTimeout(e)}},a=new Set,i=document.querySelector("#container"),o=document.querySelector("#drink-audio"),c=document.querySelector("#maskstraw-rect"),u=document.querySelector("#cup-body-wtaer"),d=(document.querySelector("#maskwaterwave-path"),document.querySelector("#maskwaterwave-anim")),h=document.querySelector("#bg-circle-front");let l=!1,E=!1;const m=new Proxy({y:+c.getAttribute("y")},{get:(t,e,s)=>{switch(e){case"y":return+c.getAttribute("y");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"y":return c.setAttribute("y",s),u.style.transform=`translateY(${s-300}px)`,!0;default:return Reflect.set(t,e,s,n)}}}),p=new Proxy({},{get:(t,e,s)=>{switch(e){case"r":return+h.getAttribute("r");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"r":return h.setAttribute("r",s),!0;default:return Reflect.set(t,e,s,n)}}}),w=()=>{console.log("setupEvents"),(()=>{let t,e;const c=()=>{t=window.performance.now(),console.log("container touchstart",t);const{promise:s,disposer:n}=r(350);e=n,s.then((()=>{l=!0}))},u=()=>{console.log("container touchend",window.performance.now()),e(),l?l=!1:(()=>{console.log("container clicked");let t=m.y;t=t+20<587?t+20:587;let e=0;if(t>=0){const r=new s({targets:[m],attrs:{y:t},duration:1e3,easing:n.InOut});a.add(r),r.start(),e=200}r(e).promise.then((()=>{d&&(E||(E=!0,d.beginElement()))})),(()=>{if(o)try{o.play()}catch(t){console.error("fail to play audio",t)}})()})()};i.addEventListener("touchstart",c),i.addEventListener("touchend",u),i.addEventListener("mousedown",c),i.addEventListener("mouseup",u),d.addEventListener("endEvent",(()=>{E=!1}))})()},v=t=>{a.forEach((e=>e.update(t))),(t=>{if(l){let t=m.y;const e=t+.3<587?t+.3:587;m.y=e}})(),window.requestAnimationFrame(v)};window.onload=()=>{console.log("hello world"),w(),v(window.performance.now());const t=new s({targets:[p],attrs:{r:600},duration:1e3,easing:n.Out});a.add(t)}})();
//# sourceMappingURL=bundle.da728cace0757cd7dd1c.js.map