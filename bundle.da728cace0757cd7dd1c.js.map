{"version":3,"file":"bundle.da728cace0757cd7dd1c.js","mappings":"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","sources":["webpack://drink-milk-tea/./src/libs/event-emitter/event.ts","webpack://drink-milk-tea/./src/libs/tween/tween.ts","webpack://drink-milk-tea/./src/libs/tween/easing.ts","webpack://drink-milk-tea/./src/utils.ts","webpack://drink-milk-tea/./src/index.ts"],"sourcesContent":["export const EVENTS = {\r\n    ERROR: 'error',\r\n};\r\nexport class EventEmitter {\r\n    constructor() {\r\n        this.eventMap = new Map();\r\n    }\r\n    addEventListener(eventName, listener) {\r\n        if (!this.eventMap.has(eventName)) {\r\n            this.eventMap.set(eventName, [listener]);\r\n        }\r\n        else {\r\n            this.eventMap.get(eventName).push(listener);\r\n        }\r\n    }\r\n    removeEventListener(eventName, listener) {\r\n        if (this.eventMap.has(eventName)) {\r\n            const listeners = this.eventMap.get(eventName);\r\n            const index = listeners.findIndex(el => el === listener);\r\n            if (index !== -1) {\r\n                listeners.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n    on(eventName, listener) {\r\n        this.addEventListener(eventName, listener);\r\n    }\r\n    once(eventName, listener) {\r\n        this.addEventListener(eventName, (...args) => {\r\n            this.removeEventListener(eventName, listener);\r\n            listener(...args);\r\n        });\r\n    }\r\n    emit(eventName, ...args) {\r\n        if (this.eventMap.has(eventName)) {\r\n            const listeners = this.eventMap.get(eventName);\r\n            listeners.forEach(el => {\r\n                try {\r\n                    el(...args);\r\n                }\r\n                catch (error) {\r\n                    console.error(`fail to excute event ${eventName}, error: `, error);\r\n                    this.emit(EVENTS.ERROR, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n","// @ts-check\r\nimport { EventEmitter } from '../event-emitter';\r\n;\r\nexport var TWEEN_STATE;\r\n(function (TWEEN_STATE) {\r\n    TWEEN_STATE[TWEEN_STATE[\"RUNNING\"] = 1] = \"RUNNING\";\r\n    TWEEN_STATE[TWEEN_STATE[\"PAUSED\"] = 2] = \"PAUSED\";\r\n    TWEEN_STATE[TWEEN_STATE[\"STOP\"] = 3] = \"STOP\";\r\n})(TWEEN_STATE || (TWEEN_STATE = {}));\r\n;\r\nexport class Tween {\r\n    constructor(options) {\r\n        this.state = TWEEN_STATE.PAUSED;\r\n        this.targetStatesMap = new Map();\r\n        this.pausedDuration = 0;\r\n        this.event = new EventEmitter();\r\n        const { targets, attrs, duration, easing, } = options;\r\n        this.targets = targets;\r\n        this.duration = duration;\r\n        this.easing = easing;\r\n        this.targets.forEach(target => {\r\n            const keys = Object.keys(attrs);\r\n            const attrStates = {};\r\n            for (const key of keys) {\r\n                const value = target[key];\r\n                if (value !== null || value !== undefined) {\r\n                    attrStates[key] = {\r\n                        from: value,\r\n                        to: attrs[key],\r\n                    };\r\n                }\r\n            }\r\n            this.targetStatesMap.set(target, attrStates);\r\n        });\r\n    }\r\n    update(elapsedTime) {\r\n        if (this.state !== TWEEN_STATE.RUNNING) {\r\n            return;\r\n        }\r\n        const now = Date.now();\r\n        const totalElapsedTime = now - this.startTime - this.pausedDuration;\r\n        let originProgress = totalElapsedTime / this.duration;\r\n        if (originProgress > 1) {\r\n            originProgress = 1;\r\n        }\r\n        let progress = originProgress;\r\n        if (this.easing) {\r\n            progress = this.easing(originProgress);\r\n        }\r\n        this.targetStatesMap.forEach((attrStates, target) => {\r\n            for (const [key, { from, to }] of Object.entries(attrStates)) {\r\n                const v = from + (to - from) * progress;\r\n                target[key] = v;\r\n            }\r\n        });\r\n        if (originProgress >= 1) {\r\n            this.state = TWEEN_STATE.STOP;\r\n            this.event.emit(Tween.EVENTS.COMPLETE);\r\n        }\r\n    }\r\n    start() {\r\n        if (!this.state || this.state === TWEEN_STATE.PAUSED) {\r\n            this.state = TWEEN_STATE.RUNNING;\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        if (!this.startTime) {\r\n            this.startTime = Date.now();\r\n        }\r\n        if (this.pausedTime) {\r\n            this.pausedDuration += Date.now() - this.pausedTime;\r\n            this.pausedTime = 0;\r\n        }\r\n        this.event.emit(Tween.EVENTS.START);\r\n    }\r\n    pause() {\r\n        if (this.state === TWEEN_STATE.RUNNING) {\r\n            this.state = TWEEN_STATE.PAUSED;\r\n            this.pausedTime = Date.now();\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        this.event.emit(Tween.EVENTS.PAUSED);\r\n    }\r\n    onStart(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.START, cb);\r\n    }\r\n    onPaused(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.PAUSED, cb);\r\n    }\r\n    onComplete(cb) {\r\n        this.event.addEventListener(Tween.EVENTS.COMPLETE, cb);\r\n    }\r\n}\r\nTween.EVENTS = {\r\n    START: 'start',\r\n    PAUSED: 'paused',\r\n    COMPLETE: 'complete',\r\n};\r\n","export const Linear = {\r\n    None: (amount) => {\r\n        return amount;\r\n    },\r\n};\r\nexport const Quadratic = {\r\n    In: (amount) => {\r\n        return amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return amount * (2 - amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount;\r\n        }\r\n        return -0.5 * (--amount * (amount - 2) - 1);\r\n    },\r\n};\r\nexport const Cubic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return --amount * amount * amount + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount;\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * amount + 2);\r\n    },\r\n};\r\nexport const Quartic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return 1 - --amount * amount * amount * amount;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount * amount;\r\n        }\r\n        return -0.5 * ((amount -= 2) * amount * amount * amount - 2);\r\n    },\r\n};\r\nexport const Quintic = {\r\n    In: (amount) => {\r\n        return amount * amount * amount * amount * amount;\r\n    },\r\n    Out: (amount) => {\r\n        return --amount * amount * amount * amount * amount + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * amount * amount * amount * amount * amount;\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * amount * amount * amount + 2);\r\n    },\r\n};\r\nexport const Sinusoidal = {\r\n    In: (amount) => {\r\n        return 1 - Math.sin(((1.0 - amount) * Math.PI) / 2);\r\n    },\r\n    Out: (amount) => {\r\n        return Math.sin((amount * Math.PI) / 2);\r\n    },\r\n    InOut: (amount) => {\r\n        return 0.5 * (1 - Math.sin(Math.PI * (0.5 - amount)));\r\n    },\r\n};\r\nexport const Exponential = {\r\n    In: (amount) => {\r\n        return amount === 0 ? 0 : Math.pow(1024, amount - 1);\r\n    },\r\n    Out: (amount) => {\r\n        return amount === 1 ? 1 : 1 - Math.pow(2, -10 * amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * Math.pow(1024, amount - 1);\r\n        }\r\n        return 0.5 * (-Math.pow(2, -10 * (amount - 1)) + 2);\r\n    },\r\n};\r\nexport const Circular = {\r\n    In: (amount) => {\r\n        return 1 - Math.sqrt(1 - amount * amount);\r\n    },\r\n    Out: (amount) => {\r\n        return Math.sqrt(1 - --amount * amount);\r\n    },\r\n    InOut: (amount) => {\r\n        if ((amount *= 2) < 1) {\r\n            return -0.5 * (Math.sqrt(1 - amount * amount) - 1);\r\n        }\r\n        return 0.5 * (Math.sqrt(1 - (amount -= 2) * amount) + 1);\r\n    },\r\n};\r\nexport const Elastic = {\r\n    In: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        return -Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n    },\r\n    Out: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        return Math.pow(2, -10 * amount) * Math.sin((amount - 0.1) * 5 * Math.PI) + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount === 0) {\r\n            return 0;\r\n        }\r\n        if (amount === 1) {\r\n            return 1;\r\n        }\r\n        amount *= 2;\r\n        if (amount < 1) {\r\n            return -0.5 * Math.pow(2, 10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI);\r\n        }\r\n        return 0.5 * Math.pow(2, -10 * (amount - 1)) * Math.sin((amount - 1.1) * 5 * Math.PI) + 1;\r\n    },\r\n};\r\nexport const Back = {\r\n    In: (amount) => {\r\n        const s = 1.70158;\r\n        return amount === 1 ? 1 : amount * amount * ((s + 1) * amount - s);\r\n    },\r\n    Out: (amount) => {\r\n        const s = 1.70158;\r\n        return amount === 0 ? 0 : --amount * amount * ((s + 1) * amount + s) + 1;\r\n    },\r\n    InOut: (amount) => {\r\n        const s = 1.70158 * 1.525;\r\n        if ((amount *= 2) < 1) {\r\n            return 0.5 * (amount * amount * ((s + 1) * amount - s));\r\n        }\r\n        return 0.5 * ((amount -= 2) * amount * ((s + 1) * amount + s) + 2);\r\n    },\r\n};\r\nexport const Bounce = {\r\n    In: (amount) => {\r\n        return 1 - Bounce.Out(1 - amount);\r\n    },\r\n    Out: (amount) => {\r\n        if (amount < 1 / 2.75) {\r\n            return 7.5625 * amount * amount;\r\n        }\r\n        else if (amount < 2 / 2.75) {\r\n            return 7.5625 * (amount -= 1.5 / 2.75) * amount + 0.75;\r\n        }\r\n        else if (amount < 2.5 / 2.75) {\r\n            return 7.5625 * (amount -= 2.25 / 2.75) * amount + 0.9375;\r\n        }\r\n        else {\r\n            return 7.5625 * (amount -= 2.625 / 2.75) * amount + 0.984375;\r\n        }\r\n    },\r\n    InOut: (amount) => {\r\n        if (amount < 0.5) {\r\n            return Bounce.In(amount * 2) * 0.5;\r\n        }\r\n        return Bounce.Out(amount * 2 - 1) * 0.5 + 0.5;\r\n    },\r\n};\r\nexport const generatePow = (power = 4) => {\r\n    power = power < Number.EPSILON ? Number.EPSILON : power;\r\n    power = power > 10000 ? 10000 : power;\r\n    return {\r\n        In: (amount) => {\r\n            return Math.pow(amount, power);\r\n        },\r\n        Out: (amount) => {\r\n            return 1 - Math.pow((1 - amount), power);\r\n        },\r\n        InOut: (amount) => {\r\n            if (amount < 0.5) {\r\n                return Math.pow((amount * 2), power) / 2;\r\n            }\r\n            return (1 - Math.pow((2 - amount * 2), power)) / 2 + 0.5;\r\n        },\r\n    };\r\n};\r\n","export const delay = (time) => {\r\n    let timer;\r\n    const promise = new Promise((resolve, reject) => {\r\n        timer = window.setTimeout(resolve, time);\r\n    });\r\n    return {\r\n        promise,\r\n        disposer: () => window.clearTimeout(timer),\r\n    };\r\n};\r\n","import { Tween, Easing } from './libs/tween';\r\nimport { delay } from './utils';\r\nconst tweens = new Set();\r\nconst container = document.querySelector('#container');\r\nconst drinkAudio = document.querySelector('#drink-audio');\r\nconst maskStrawRect = document.querySelector('#maskstraw-rect');\r\nconst cupBodyWtaer = document.querySelector('#cup-body-wtaer');\r\nconst maskWaterWavePath = document.querySelector('#maskwaterwave-path');\r\nconst maskWaterWaveAnim = document.querySelector('#maskwaterwave-anim');\r\nconst bgCircle = document.querySelector('#bg-circle-front');\r\nconst drinkCapacity = 20;\r\nlet isLongPress = false;\r\nlet isPlayingWaveAnim = false;\r\nconst playAudio = () => {\r\n    if (drinkAudio) {\r\n        try {\r\n            drinkAudio.play();\r\n        }\r\n        catch (error) {\r\n            console.error('fail to play audio', error);\r\n        }\r\n    }\r\n};\r\nconst playWaterWobbleAnim = () => {\r\n    if (!maskWaterWaveAnim) {\r\n        return;\r\n    }\r\n    if (isPlayingWaveAnim) {\r\n        return;\r\n    }\r\n    isPlayingWaveAnim = true;\r\n    maskWaterWaveAnim.beginElement();\r\n};\r\nconst waterProxy = new Proxy({\r\n    y: +maskStrawRect.getAttribute('y'),\r\n}, {\r\n    get: (target, key, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                return +maskStrawRect.getAttribute('y');\r\n            default:\r\n                return Reflect.get(target, key, receiver);\r\n        }\r\n    },\r\n    set: (target, key, value, receiver) => {\r\n        switch (key) {\r\n            case 'y':\r\n                maskStrawRect.setAttribute('y', value);\r\n                cupBodyWtaer.style.transform = `translateY(${value - 300}px)`;\r\n                return true;\r\n            default:\r\n                return Reflect.set(target, key, value, receiver);\r\n        }\r\n    }\r\n});\r\nconst circleProxy = new Proxy({}, {\r\n    get: (target, key, receiver) => {\r\n        switch (key) {\r\n            case 'r':\r\n                return +bgCircle.getAttribute('r');\r\n            default:\r\n                return Reflect.get(target, key, receiver);\r\n        }\r\n    },\r\n    set: (target, key, value, receiver) => {\r\n        switch (key) {\r\n            case 'r':\r\n                bgCircle.setAttribute('r', value);\r\n                return true;\r\n            default:\r\n                return Reflect.set(target, key, value, receiver);\r\n        }\r\n    }\r\n});\r\nconst handleClickCup = () => {\r\n    console.log('container clicked');\r\n    let curY = waterProxy.y;\r\n    curY = (curY + drinkCapacity) < 587 ? curY + drinkCapacity : 587;\r\n    let waveAnimDelay = 0;\r\n    if (curY >= 0) {\r\n        // waterProxy.y = curY;\r\n        const tween = new Tween({\r\n            targets: [waterProxy],\r\n            attrs: {\r\n                y: curY,\r\n            },\r\n            duration: 1000,\r\n            easing: Easing.Cubic.InOut,\r\n        });\r\n        tweens.add(tween);\r\n        tween.start();\r\n        waveAnimDelay = 200;\r\n    }\r\n    delay(waveAnimDelay).promise.then(() => playWaterWobbleAnim());\r\n    playAudio();\r\n};\r\nconst updateWater = (elapsedTime) => {\r\n    if (isLongPress) {\r\n        let curY = waterProxy.y;\r\n        const newY = (curY + 0.3) < 587 ? curY + 0.3 : 587;\r\n        waterProxy.y = newY;\r\n    }\r\n};\r\nconst setupTouchEvents = () => {\r\n    let touchStartTime;\r\n    let longPressTimerDisposer;\r\n    const handleTouchStart = () => {\r\n        touchStartTime = window.performance.now();\r\n        console.log('container touchstart', touchStartTime);\r\n        const { promise: delayPromise, disposer: delayDisposer, } = delay(350);\r\n        longPressTimerDisposer = delayDisposer;\r\n        delayPromise.then(() => {\r\n            isLongPress = true;\r\n        });\r\n    };\r\n    const handleTouchEnd = () => {\r\n        console.log('container touchend', window.performance.now());\r\n        longPressTimerDisposer();\r\n        if (!isLongPress) {\r\n            handleClickCup();\r\n        }\r\n        else {\r\n            isLongPress = false;\r\n        }\r\n    };\r\n    container.addEventListener('touchstart', handleTouchStart);\r\n    container.addEventListener('touchend', handleTouchEnd);\r\n    container.addEventListener('mousedown', handleTouchStart);\r\n    container.addEventListener('mouseup', handleTouchEnd);\r\n    maskWaterWaveAnim.addEventListener('endEvent', () => {\r\n        isPlayingWaveAnim = false;\r\n    });\r\n};\r\nconst setupEvents = () => {\r\n    console.log('setupEvents');\r\n    setupTouchEvents();\r\n};\r\nconst mainLoop = (timestamp) => {\r\n    // console.log('mainLoop', timestamp);\r\n    tweens.forEach(tween => tween.update(timestamp));\r\n    updateWater();\r\n    window.requestAnimationFrame(mainLoop);\r\n};\r\nwindow.onload = () => {\r\n    console.log('hello world');\r\n    setupEvents();\r\n    mainLoop(window.performance.now());\r\n    const tween = new Tween({\r\n        targets: [circleProxy],\r\n        attrs: {\r\n            r: 600,\r\n        },\r\n        duration: 1000,\r\n        easing: Easing.Cubic.Out,\r\n    });\r\n    tweens.add(tween);\r\n    // delay(2000).promise.then(() => tween.start());\r\n    // tween.start();\r\n};\r\n"],"names":["EventEmitter","constructor","this","eventMap","Map","addEventListener","eventName","listener","has","get","push","set","removeEventListener","listeners","index","findIndex","el","splice","on","once","args","emit","forEach","error","console","TWEEN_STATE","Tween","options","state","PAUSED","targetStatesMap","pausedDuration","event","targets","attrs","duration","easing","target","keys","Object","attrStates","key","value","undefined","from","to","update","elapsedTime","RUNNING","originProgress","Date","now","startTime","progress","entries","v","STOP","EVENTS","COMPLETE","start","pausedTime","START","pause","onStart","cb","onPaused","onComplete","Cubic","In","amount","Out","InOut","delay","time","timer","promise","Promise","resolve","reject","window","setTimeout","disposer","clearTimeout","tweens","Set","container","document","querySelector","drinkAudio","maskStrawRect","cupBodyWtaer","maskWaterWaveAnim","bgCircle","isLongPress","isPlayingWaveAnim","waterProxy","Proxy","y","getAttribute","receiver","Reflect","setAttribute","style","transform","circleProxy","setupEvents","log","touchStartTime","longPressTimerDisposer","handleTouchStart","performance","delayPromise","delayDisposer","then","handleTouchEnd","curY","waveAnimDelay","tween","add","beginElement","play","playAudio","handleClickCup","setupTouchEvents","mainLoop","timestamp","newY","updateWater","requestAnimationFrame","onload","r"],"sourceRoot":""}