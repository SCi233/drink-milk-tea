(()=>{"use strict";const t=t=>{let e;return{promise:new Promise(((s,n)=>{e=window.setTimeout(s,t)})),disposer:()=>window.clearTimeout(e)}},e=document.querySelector("#drink-audio");var s;!function(t){t.DRINK="drink"}(s||(s={}));const n={[s.DRINK]:e},o=t=>{const e=n[t];if(e)try{e.play()}catch(e){console.error("fail to play audio ",t,e)}else console.error("fail to play audio ",t,new Error("can not find audio element."))};class r{constructor(){this.eventMap=new Map}addEventListener(t,e){this.eventMap.has(t)?this.eventMap.get(t).push(e):this.eventMap.set(t,[e])}removeEventListener(t,e){if(this.eventMap.has(t)){const s=this.eventMap.get(t),n=s.findIndex((t=>t===e));-1!==n&&s.splice(n,1)}}on(t,e){this.addEventListener(t,e)}once(t,e){this.addEventListener(t,((...s)=>{this.removeEventListener(t,e),e(...s)}))}emit(t,...e){this.eventMap.has(t)&&this.eventMap.get(t).forEach((s=>{try{s(...e)}catch(e){console.error(`fail to excute event ${t}, error: `,e),this.emit("error",e)}}))}}var a;!function(t){t[t.RUNNING=1]="RUNNING",t[t.PAUSED=2]="PAUSED",t[t.STOP=3]="STOP"}(a||(a={}));class i{constructor(t){this.state=a.PAUSED,this.targetStatesMap=new Map,this.pausedDuration=0,this.event=new r;const{targets:e,attrs:s,duration:n,easing:o}=t;this.targets=e,this.duration=n,this.easing=o,this.targets.forEach((t=>{const e=Object.keys(s),n={};for(const o of e){const e=t[o];null===e&&void 0===e||(n[o]={from:e,to:s[o]})}this.targetStatesMap.set(t,n)}))}update(t){if(this.state!==a.RUNNING)return;let e=(Date.now()-this.startTime-this.pausedDuration)/this.duration;e>1&&(e=1);let s=e;this.easing&&(s=this.easing(e)),this.targetStatesMap.forEach(((t,e)=>{for(const[n,{from:o,to:r}]of Object.entries(t)){const t=o+(r-o)*s;e[n]=t}})),e>=1&&(this.state=a.STOP,this.event.emit(i.EVENTS.COMPLETE))}start(){this.state&&this.state!==a.PAUSED||(this.state=a.RUNNING,this.startTime||(this.startTime=Date.now()),this.pausedTime&&(this.pausedDuration+=Date.now()-this.pausedTime,this.pausedTime=0),this.event.emit(i.EVENTS.START))}pause(){this.state===a.RUNNING&&(this.state=a.PAUSED,this.pausedTime=Date.now(),this.event.emit(i.EVENTS.PAUSED))}stop(){this.state!==a.STOP&&(this.state=a.STOP,this.event.emit(i.EVENTS.STOP))}onStart(t){this.event.addEventListener(i.EVENTS.START,t)}onPaused(t){this.event.addEventListener(i.EVENTS.PAUSED,t)}onComplete(t){this.event.addEventListener(i.EVENTS.COMPLETE,t)}onStop(t){this.event.addEventListener(i.EVENTS.STOP,t)}}i.EVENTS={START:"start",PAUSED:"paused",COMPLETE:"complete",STOP:"stop"};const u={In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},c={In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)};class d{constructor(){this.tweens=new Set,this.mainLoop=t=>{try{this.update(t)}catch(t){console.error("fail to update tween, error: "+t)}window.requestAnimationFrame(this.mainLoop)},this.mainLoop()}update(t){this.tweens.forEach((e=>e.update(t)))}add(t){const e=new i(t),s=()=>this.remove(e);return e.onComplete(s),e.onStop(s),this.tweens.add(e),e.start(),e}remove(t){this.tweens.has(t)?(t.stop(),this.tweens.delete(t)):console.warn("fail to remove tween, can not found.")}pause(t){this.tweens.has(t)?t.pause():console.warn("fail to pause tween, can not found.")}stop(t){this.remove(t)}}const h=587,l={offsetY:20,duration:1e3},m=document.querySelector("#maskstraw-rect"),p=document.querySelector("#cup-body-wtaer"),w=(document.querySelector("#maskwaterwave-path"),document.querySelector("#maskwaterwave-anim")),E=new d;let v=!1,f=0;const S=new Proxy({y:+m.getAttribute("y")},{get:(t,e,s)=>{switch(e){case"y":return+m.getAttribute("y");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"y":return m.setAttribute("y",s),p.style.transform=`translateY(${s-300}px)`,!0;default:return Reflect.set(t,e,s,n)}}}),g=()=>{w&&(v||f<=0||(--f,v=!0,w.beginElement()))};w&&(console.log("register maskWaterWaveAnim events."),w.addEventListener("endEvent",(()=>{console.log("endEvent trigger."),v=!1,f>0&&g()})));const y=e=>{let{offsetY:s=l.offsetY,duration:n=l.duration}=e;s<=0&&(s=l.offsetY),n<=0&&(n=l.duration);let o=(t=>{let e=S.y;return e=e+t<h?e+t:h,e})(s);return o<=0?Promise.resolve():(f>0?f=3:t(o>0?200:0).promise.then((()=>{f=3,g()})),((t,e)=>new Promise(((s,n)=>{E.add({targets:[S],attrs:{y:t},duration:e,easing:c.InOut}).onComplete((()=>{console.log("complete."),s()}))})))(o,n))},T=document.querySelector("#mask-straw-drinking-rect"),N=document.querySelector("#maskstraw-rect"),P=new d,A=new Proxy({y:+T.getAttribute("y")},{get:(t,e,s)=>{switch(e){case"y":return+T.getAttribute("y");default:return Reflect.get(t,e,s)}},set:(t,e,s,n)=>{switch(e){case"y":return T.setAttribute("y",s),!0;default:return Reflect.set(t,e,s,n)}}}),L=document.querySelector("#container");let D=!1,O=!1;const I=()=>{console.log("setupEvents"),(()=>{let e,n;const r=()=>{e=window.performance.now();const{promise:s,disposer:o}=t(350);n=o,s.then((()=>{D=!0}))},a=()=>{n(),D?D=!1:(console.log("container clicked"),+T.getAttribute("y")>=h||P.add({targets:[A],attrs:{y:100},duration:200,easing:u.In}),y({}).then((()=>(()=>{if(+T.getAttribute("y")>=h)return;const t=+N.getAttribute("y");null===t&&void 0===t||P.add({targets:[A],attrs:{y:t},duration:160,easing:u.Out})})())),o(s.DRINK))};L.addEventListener("touchstart",r),L.addEventListener("touchend",a),L.addEventListener("mousedown",r),L.addEventListener("mouseup",a)})()},M=t=>{(t=>{if(D&&!O){O=!0;const t=()=>{y({}).then((()=>{D&&t()})),o(s.DRINK)};t()}})(),window.requestAnimationFrame(M)};window.onload=()=>{I(),M(window.performance.now())}})();
//# sourceMappingURL=bundle.f83fb6f418c5f205ef0e.js.map